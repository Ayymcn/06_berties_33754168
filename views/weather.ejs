<!doctype html>
<html>
  <head>
    <title>Weather - <%= shopData.shopName %></title>
    <link rel="stylesheet" type="text/css" href="/main.css" />
  </head>
  <body>
    <div class="container">

      <nav>
        <div class="nav-container">
          <div class="nav-left">
            <a href="/">Home</a> | 
            <a href="/about">About</a> | 
            <a href="/books/search">Search</a> | 
            <a href="/books/list">List Books</a> |
            <a href="/books/bargainbooks">Bargain Books</a> |
            <a href="/users/list">List Users</a> | 
            <a href="/users/audit">Audit Log</a> |
            <a href="/users/logout">Logout</a> |
            <a href="/weather">Weather</a>
          </div>

          <div class="nav-right">
            <a href="/users/register">Register</a>
            <a href="/users/login" class="login-btn" style="margin-left: 10px;">Login</a>
          </div>
        </div>
      </nav>

      <hr>

      <h1>Weather Forecast</h1>

      <!-- City search form -->
      <form method="get" action="/weather" style="margin-top: 20px;">
        <label for="city">Enter city:</label>
        <input
          type="text"
          id="city"
          name="city"
          value="<%= typeof city !== 'undefined' ? city : '' %>"
        >
        <button type="submit">Get weather</button>
      </form>

      <% if (error) { %>
        <div class="error" style="margin-top: 15px; color: red;">
          <p><%= error %></p>
        </div>
      <% } %>

      <% if (weather && !error) { %>
        <div style="margin-top: 20px; padding: 20px; background-color: #f9f9f9; border-radius: 8px;">
          <h2>
            <%= weather.name %>
            <% if (weather.sys && weather.sys.country) { %>
              (<%= weather.sys.country %>)
            <% } %>
          </h2>

          <% if (weather.weather && weather.weather.length) { %>
            <p><strong>Conditions:</strong> <%= weather.weather[0].main %> - <%= weather.weather[0].description %></p>
          <% } %>

          <% if (weather.main) { %>
            <p><strong>Temperature:</strong> <%= weather.main.temp %> 째C</p>
            <p><strong>Feels like:</strong> <%= weather.main.feels_like %> 째C</p>
            <p><strong>Min/Max:</strong> <%= weather.main.temp_min %> / <%= weather.main.temp_max %> 째C</p>
            <p><strong>Humidity:</strong> <%= weather.main.humidity %>%</p>
            <p><strong>Pressure:</strong> <%= weather.main.pressure %> hPa</p>
          <% } %>

          <% if (weather.wind) { %>
            <p><strong>Wind:</strong> <%= weather.wind.speed %> m/s
              <% if (typeof weather.wind.deg !== 'undefined') { %>
                , direction <%= weather.wind.deg %>째
              <% } %>
            </p>
          <% } %>

          <% if (weather.clouds) { %>
            <p><strong>Cloudiness:</strong> <%= weather.clouds.all %>%</p>
          <% } %>
        </div>

        <div style="margin-top: 20px;">
          <h3>Raw JSON response</h3>
          <pre><%= JSON.stringify(weather, null, 2) %></pre>
        </div>
      <% } else if (!error) { %>
        <p style="margin-top: 20px;">No weather data available yet. Try searching for a city above.</p>
      <% } %>

    </div>
  </body>
</html>
